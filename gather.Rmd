---
title: "gather"
author: "Eleanor Fitzgibbons"
date: "11/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(gt)
```


```{r}
SCDB_2020_01_justiceCentered_Docket <- 
  read_csv("final-app/SCDB_2020_01_justiceCentered_Docket.csv",
           col_types = cols(.default = col_double(),
                            caseId = col_character(),
                            docketId = col_character(),
                            caseIssuesId = col_character(),
                            voteId = col_character(),
                            dateDecision = col_character(),
                            usCite = col_character(),
                            sctCite = col_character(),
                            ledCite = col_character(),
                            lexisCite = col_character(),
                            chief = col_character(),
                            caseName = col_character(),
                            dateArgument = col_character(),
                            dateRearg = col_character(),
                            lawMinor = col_character(),
                            justiceName = col_character()))
```

```{r}
SCDB_2020_01_justiceCentered_Citation <- 
  read_csv("final-app/SCDB_2020_01_justiceCentered_Citation.csv",
           col_types = cols(.default = col_double(),
                            caseId = col_character(),
                            docketId = col_character(),
                            caseIssuesId = col_character(),
                            voteId = col_character(),
                            dateDecision = col_character(),
                            usCite = col_character(),
                            sctCite = col_character(),
                            ledCite = col_character(),
                            lexisCite = col_character(),
                            chief = col_character(),
                            caseName = col_character(),
                            dateArgument = col_character(),
                            dateRearg = col_character(),
                            lawMinor = col_character(),
                            justiceName = col_character()))

Citation_Data <- SCDB_2020_01_justiceCentered_Citation %>% 
  select(sctCite, caseId, caseName, dateDecision, dateArgument, chief, issue, issueArea,
         decisionDirection, justiceName, vote, opinion, direction, majority) %>% 
  mutate(date = str_sub(dateDecision, -4)) %>% 

  # Originally did == instead of %in%  
  
  mutate(president = case_when(justiceName %in% c("RHJackson", "WODouglas", "FFrankfurter",
                                                "SFReed", "HLBlack", "WBRutledge",
                                                "FMurphy") ~ "Roosevelt",
                               justiceName %in% c("HHBurton", "FMVinson", "TCClark",
                                                "SMinton") ~ "Truman",
                               justiceName %in% c("EWarren", "JHarlan2", "WJBrennan",
                                                "CEWhittaker", "PStewart") ~ "Eisenhower",
                               justiceName %in% c("BRWhite", "AJGoldberg") ~ "Kennedy",
                               justiceName %in% c("AFortas", "TMarshall") ~ "Johnson",
                               justiceName %in% c("WEBurger", "HABlackmun", "LFPowell", 
                                                "WHRehnquist") ~ "Nixon",
                               justiceName %in% c("JPStevens") ~ "Ford",
                               justiceName %in% c("SDOConnor", "AScalia", 
                                                "AMKennedy") ~ "Reagan",
                               justiceName %in% c("DHSouter", "CThomas") ~ "HW Bush",
                               justiceName %in% c("RBGinsburg", "SGBreyer") ~ "Clinton",
                               justiceName %in% c("JGRoberts", "SAAlito") ~ "Bush",
                               justiceName %in% c("SSotomayor", "EKagan") ~ "Obama",
                               justiceName %in% c("NMGorsuch", "BMKavanaugh") ~ "Trump")) %>%
  group_by(justiceName) %>% 
  mutate(direction_mean = mean(direction, na.rm = TRUE)) %>% 
  ungroup() %>% 
  mutate(chiefYES = case_when(chief == str_sub(justiceName, 3, -1) ~ "yes",
                              chief == str_sub(justiceName, 2, -1) ~ "yes",
                              TRUE ~ "no"))

setwd("~/Desktop/projects/gov50-final-project/final-app")
write.csv(Citation_Data, "final-app/Citation_Data.csv")

```

```{r}

# How do I make this interactive so you can see the leaning of each justice depending on who you pick?
Citation_Data %>% 
  filter(justiceName == "RBGinsburg") %>% 
  drop_na(direction) %>% 
  ggplot(aes(x = direction)) +
  geom_bar() +
  labs(title = "Ideological Direction Count",
       x = "Direction",
       y = "Count") +
  
  # What am I doing wrong here? Confused as to why these labels won't show up
  
  scale_x_discrete(labels = c("Conservative", "Liberal"))
```

```{r}
Citation_Data %>% 
  ggplot(aes(x = fct_reorder(justiceName, direction_mean), y = direction_mean)) +
  geom_point() +
  labs(title = "Ideological Direction of Supreme Court Justices",
       subtitle = "Average of Ideological Leanings in Cases from 1946-2020",
       x = "Justices",
       y = "Ideological Direction") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}

# How do I make this an interactive graph you can toggle the president?

each_president <- Citation_Data %>% 
  filter(president == "Clinton") %>% 
  ggplot(aes(x = justiceName, y = direction_mean)) +
  geom_point()
```

```{r}

# How can I better look at trends between the way that justices voted and the issue type?

Citation_Data %>% 
  filter(justiceName == "NMGorsuch") %>% 
  ggplot(aes(x = caseId, y = direction)) +
  geom_col() +
  facet_wrap( ~issueArea) +
  theme(axis.text.x = element_text(angle = 90))
```

Is the chief justice typically in the majority?
```{r}
chief_in_maj <- Citation_Data %>%
  group_by(justiceName) %>% 
  mutate(n_maj = sum(majority == 2, na.rm = TRUE),
         pct_maj = n_maj/sum(majority, na.rm = TRUE),
         .groups = "drop") %>% 
  ggplot(aes(x = justiceName, y = pct_maj, color = chiefYES)) +
  geom_point() +
  labs(title = "Are Chief Justices More Frequently in the Majority?",
       x = "Justice",
       y = "Percent of Time in Majority") +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_color_manual(labels = c("No", "Yes"),
                     values = c("green", "blue"),
                     name = "Chief Justice?")
```

Frequency in majority over time?
```{r}
# Can I put two graphs next to each other that will allow me to compare two different justices?

Citation_Data %>% 
  group_by(justiceName, date) %>% 
  mutate(n_maj_year = sum(majority == 2, na.rm = TRUE)) %>% 
  mutate(pct_maj_year = n_maj_year/sum(majority %in% c(1, 2), na.rm = TRUE)) %>% 
  filter(justiceName %in% c("CThomas", "RBGinsburg")) %>% 
  distinct(date, .keep_all = TRUE) %>% 
  ggplot(aes(x = date, y = pct_maj_year, fill = justiceName)) +
  geom_col(position = position_dodge()) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_y_continuous(labels = scales::percent_format())
```



A look at the judge's distribution by issue
```{r}

# Toggle issueArea to see which justices tend to vote more liberally depending on the context

# 11 resulted in nothing and 13 and 14 have very few data points...

direction_by_issue <- Citation_Data %>% 
  filter(issueArea == 2) %>% 
  group_by(justiceName) %>% 
  mutate(direction_mean_issue = mean(direction, na.rm = TRUE)) %>% 
  ungroup() %>% 
  ggplot(aes(x = justiceName, y = direction_mean_issue)) +
  geom_point() +
  labs(title = "Average Ideological Leaning By Issue",
       x = "Justice",
       y = "Average Ideological Direction") +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
IssueArea <- tibble(Number = c(1:14),
                    Issue = c("Criminal Procedure", "Civil Rights", 
                              "First Amendment", "Due Process",  "Privacy", 
                              "Attorneys", "Unions", "Economic Activity", 
                              "Judicial Power", "Federalism", 
                              "Interstate Relations", "Federal Taxation", 
                              "Miscellaneous", "Private Action"))
gt_IssueArea <- gt(data = IssueArea) %>% 
  tab_header(title = "Issue Area Code")

# Link to online code book for SCDB: http://supremecourtdatabase.org/documentation.php
```


What are the specific issues inside of each issue area?
```{r}
Citation_Data %>% 
  select(issue, issueArea) %>% 
  filter(issueArea == 1) %>% 
  distinct(issue) %>% 
  arrange(issue) %>% 
  mutate(issue_name = c("involuntary confession", "habeas corpus", "plea bargaining: the constitutionality of and/or the circumstances of its exercise", "retroactivity (of newly announced or newly enacted constitutional or statutory rights)", "search and seizure (other than as pertains to vehicles or Crime Control Act)", "search and seizure, vehicles", "search and seizure, Crime Control Act", "contempt of court or congress", "self-incrimination (other than as pertains to Miranda or immunity from prosecution)", "Miranda warnings", "self-incrimination, immunity from prosecution", "right to counsel (cf. indigents appointment of counsel or inadequate representation)", "cruel and unusual punishment, death penalty (cf. extra legal jury influence, death penalty)", "cruel and unusual punishment, non-death penalty (cf. liability, civil rights acts)", "line-up", "discovery and inspection (in the context of criminal litigation only, otherwise Freedom of Information Act and related federal or state statutes or regulations)", "double jeopardy", "ex post facto (state)", "extra-legal jury influences: miscellaneous", "extra-legal jury influences: prejudicial statements or evidence", "extra-legal jury influences: contact with jurors outside courtroom", "extra-legal jury influences: jury instructions (not necessarily in criminal cases)", "extra-legal jury influences: voir dire (not necessarily a criminal case)", "extra-legal jury influences: prison garb or appearance", "extra-legal jury influences: jurors and death penalty (cf. cruel and unusual punishment)", "extra-legal jury influences: pretrial publicity", "confrontation (right to confront accuser, call and cross-examine witnesses)", "subconstitutional fair procedure: confession of error", "subconstitutional fair procedure: conspiracy (cf. Federal Rules of Criminal Procedure: conspiracy)", "subconstitutional fair procedure: entrapment", "subconstitutional fair procedure: exhaustion of remedies", "subconstitutional fair procedure: fugitive from justice", "subconstitutional fair procedure: presentation, admissibility, or sufficiency of evidence (not necessarily a criminal case)", "subconstitutional fair procedure: stay of execution", "subconstitutional fair procedure: timeliness", "subconstitutional fair procedure: miscellaneous", "Federal Rules of Criminal Procedure", "statutory construction of criminal laws: assault", "statutory construction of criminal laws: bank robbery", "statutory construction of criminal laws: conspiracy (cf. subconstitutional fair procedure: conspiracy)", "statutory construction of criminal laws: escape from custody", "statutory construction of criminal laws: false statements (cf. statutory construction of criminal laws: perjury)", "statutory construction internal revenue)", "statutory construction", "statutory construction", "statutory construction", "statutory construction", "statutory construction naturalization)", "statutory construction", "statutory construction", "statutory construction prohibition of alcohol", "statutory construction", "statutory construction statutory construction","statutory construction", "statutory construction", "statutory construction", "statutory construction
of criminal laws: financial (other than in fraud or
of criminal laws: firearms
of criminal laws: fraud
of criminal laws: gambling
of criminal laws: Hobbs Act; i.e., 18 USC 1951
of criminal laws: immigration (cf. immigration and
of criminal laws: internal revenue (cf. Federal Taxation) of criminal laws: Mann Act and related statutes
of criminal laws: narcotics includes regulation and
of criminal laws: obstruction of justice
of criminal laws: perjury (other than as pertains to of criminal laws: false statements)
of criminal laws: Travel Act, 18 USC 1952
of criminal laws: war crimes
of criminal laws: sentencing guidelines of criminal laws: miscellaneous", "jury trial (right to, as distinct from extra-legal jury influences)", "speedy trial", "miscellaneous criminal procedure (cf. due process, prisoners' rights, comity:criminal procedure)"))
```

```{r}

# ggplot(d, aes(.data[[input$x]], .data[[input$y]])) +
#             plot_geom()


model_data <- Citation_Data %>% 
  mutate(outcome = case_when(direction == 1 ~ 1,
                             direction == 2 ~ 0))

model <- glm(outcome ~ chief + justiceName + date,
             data = model_data,
             family = "binomial")
summary(model)
```






